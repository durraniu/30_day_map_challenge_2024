{
  "hash": "d9c458fca3b004f77f5115057ab41c3b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Day 1: Points\"\ndate: \"2024-11-01\"\ncategories: [points, crashapi, tigris]\ncache: true\n---\n\n\n\n\n\n## Data\n\nI used the [crashapi](https://github.com/elipousson/crashapi) package to gather fatal vehicle crashes for New York city for 2019-2020. Before looking at the maps, recall that stay-at-home orders were given in 2020 due to COVID-19. Therefore, the number of fatal crashes were expected to decrease in 2020 compared to 2019.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# devtools::install_github(\"elipousson/crashapi\")\nlibrary(crashapi)\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(tigris)\nlibrary(patchwork)\n```\n:::\n\n\n\n\n\nThere are 5 counties in New York City, so I made a function to download county data using the `crashapi` package:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nget_ny_county_data <- function(county){\n  crashapi::get_fars(\n    year = c(2019, 2020),\n    state = \"New York\",\n    county = county,\n    details = FALSE,\n    geometry = TRUE\n  )\n}\n\nny_counties <-  c(\"New York County\", \"Kings County\", \n    \"Queens County\", \"Bronx County\",\n    \"Richmond County\")\n\nny_crashes <- purrr::map(\n  ny_counties,\n  ~ get_ny_county_data(.x)\n) \n\nny_crashes <- purrr::set_names(ny_crashes, ny_counties) \n```\n:::\n\n\n\n\n\nThen I created two lists of dataframes for each year:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nny_crashes19 <- purrr::map(ny_crashes, ~ .x |>\n                             janitor::clean_names() |> \n                             dplyr::filter(case_year == \"2019\"))\nny_crashes20 <- purrr::map(ny_crashes, ~ .x |> \n                             janitor::clean_names() |> \n                             dplyr::filter(case_year == \"2020\"))\n```\n:::\n\n\n\n\n\n### City Boundary\n\nCity boundary was downloaded using the `tigris` package:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nny_places <- places(state = \"NY\", cb = TRUE, progress_bar = FALSE)\nnyc_boundary <- ny_places[ny_places$NAME == \"New York\", ]\n```\n:::\n\n\n\n\n\n## Point Maps\n\nFinally, I was ready to visualize the single-vehicle fatal crashes in different counties. The function below does exactly that for a given year and county:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_county_crashes <- function(crash_list, num, total_vehs = \"1\"){\n  dataset <- crash_list[[num]]\n  county <- names(crash_list[num])\n  num_cases <- nrow(dataset)\n  year <- unique(dataset$case_year)\n  \n  ggplot() +\n  geom_sf(data = nyc_boundary, fill = NA, color = \"grey50\") +\n  geom_sf(\n    data = dataset |> \n      dplyr::filter(totalvehicles == total_vehs),\n    aes(color =  totalvehicles),\n    alpha = 0.5\n  ) +\n  labs(title = paste0(county, \" (\", year, \")\"),\n       subtitle = paste0(\" (# of crashes: \", num_cases, \")\")) +\n  theme_void() +\n  theme(legend.position = \"none\")\n}\n```\n:::\n\n\n\n\n\nAnd the following function plots the same county for both years:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncreate_combined_plot <- function(num,\n                                 list1 = ny_crashes19,\n                                 list2 = ny_crashes20\n                                 ){\n  plot_county_crashes(list1, num) | plot_county_crashes(list2, num)\n}\n```\n:::\n\n\n\n\n\n### Maps\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncreate_combined_plot(1)\n```\n\n::: {.cell-output-display}\n![](day1_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncreate_combined_plot(2)\n```\n\n::: {.cell-output-display}\n![](day1_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n\n```{.r .cell-code}\ncreate_combined_plot(4)\n```\n\n::: {.cell-output-display}\n![](day1_files/figure-html/unnamed-chunk-6-3.png){width=672}\n:::\n\n```{.r .cell-code}\ncreate_combined_plot(5)\n```\n\n::: {.cell-output-display}\n![](day1_files/figure-html/unnamed-chunk-6-4.png){width=672}\n:::\n:::\n\n\n\n\n\nBronx county had twice the crashes in 2020 compared to 2019!\n\nAnd something is wrong with the data for Queens county:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncreate_combined_plot(3)\n```\n\n::: {.cell-output-display}\n![](day1_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}